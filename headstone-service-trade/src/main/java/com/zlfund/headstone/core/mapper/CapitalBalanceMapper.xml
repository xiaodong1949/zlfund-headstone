<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zlfund.headstone.core.mapper.CapitalBalanceMapper">

  <select id="countCapitalBalance" parameterType="CapitalBalance" resultType="int">
    select count(custno) from capitalbalance t1
    <where>
      <if test="capitalBalance.tradeAcco != null and capitalBalance.tradeAcco != ''">
        and t1.tradeacco = #{capitalBalance.tradeAcco }
      </if>
      <if test="capitalBalance.custNo != null and capitalBalance.custNo != ''">
        and t1.custno = #{capitalBalance.custNo }
      </if>
    </where>
  </select>

  <insert id="saveCapitalBalance" parameterType="CapitalBalance" statementType="CALLABLE">
    INSERT INTO capitalbalance(
            tradeacco, 
            custno, 
            balance, 
            abnmfrozen, 
            lastdate, 
            updatetimestamp, 
            transferstatus, 
            returnbalance, 
            soadate)
    VALUES (#{capitalBalance.tradeAcco}, 
            #{capitalBalance.custNo}, 
            #{capitalBalance.balance}, 
            #{capitalBalance.abnmFrozen}, 
            #{capitalBalance.lastDate}, 
            #{capitalBalance.updateTimeStamp}, 
            #{capitalBalance.transferStatus}, 
            #{capitalBalance.returnBalance}, 
            #{capitalBalance.soaDate});
  </insert>

  <update id="updateCapitalBalance" parameterType="CapitalBalance" statementType="CALLABLE">
    UPDATE capitalbalance t1
    <set>
       <if test="capitalBalance.abnmFrozen != null">
        abnmfrozen = #{capitalBalance.abnmFrozen }
       </if>
    </set>
    <where>
      <if test="capitalBalance.tradeAcco != null and capitalBalance.tradeAcco != ''">
        and t1.tradeacco = #{capitalBalance.tradeAcco }
      </if>
      <if test="capitalBalance.custNo != null and capitalBalance.custNo != ''">
        and t1.custno = #{capitalBalance.custNo }
      </if>
    </where>
  </update>
  
  <select id="getCapitalBalance" parameterType="CapitalBalance" resultType="CapitalBalance">
    SELECT tradeacco, custno, balance, abnmfrozen, lastdate, updatetimestamp, 
       transferstatus, returnbalance, soadate
    FROM capitalbalance t1
    <where>
      <if test="capitalBalance.tradeAcco != null and capitalBalance.tradeAcco != ''">
        and t1.tradeacco = #{capitalBalance.tradeAcco }
      </if>
      <if test="capitalBalance.custNo != null and capitalBalance.custNo != ''">
        and t1.custno = #{capitalBalance.custNo }
      </if>
    </where>
  </select>
  
</mapper>